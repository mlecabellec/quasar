--- driver_entry.c	2014-10-17 16:31:00.000000000 +0000
+++ driver_entry.c	2024-10-11 08:59:01.435681899 +0000
@@ -171,7 +171,11 @@
                 }
             }
 
+#if LINUX_VERSION_CODE >= KERNEL_VERSION(5,0,0)
+            MappedAddr = (RFM2G_ADDR)ioremap( BaseAddr, mapSize);
+#else
             MappedAddr = (RFM2G_ADDR)ioremap_nocache( BaseAddr, mapSize);
+#endif
             if( MappedAddr == 0 )
             {
                 /* Error */
@@ -392,7 +396,11 @@
 
 
     /* Extract the minor number so we know which RFM device to access */
+# if LINUX_VERSION_CODE < KERNEL_VERSION(4,0,0)
     unit = MINOR( filp->f_dentry->d_inode->i_rdev );
+# else
+    unit = MINOR( filp->f_path.dentry->d_inode->i_rdev );
+#endif
     cfg = &(rfm2gDeviceInfo[unit].Config );
 
     WHENDEBUG(RFM2G_DBTRACE) printk(KERN_ERR"%s%d: Entering %s\n", devname,
@@ -479,7 +487,11 @@
     l_offset = (RFM2G_UINT32) *offset;
 
     /* Extract the minor number so we know which RFM device to access */
+# if LINUX_VERSION_CODE < KERNEL_VERSION(4,0,0)
     unit = MINOR( filp->f_dentry->d_inode->i_rdev );
+# else
+    unit = MINOR( filp->f_path.dentry->d_inode->i_rdev );
+#endif
 
     WHENDEBUG(RFM2G_DBTRACE) printk(KERN_ERR"%s%d: Entering %s\n", devname,
                                     unit, me);
@@ -571,7 +583,11 @@
     l_offset = (RFM2G_UINT32) *offset;
 
     /* Extract the minor number so we know which RFM device to access */
+# if LINUX_VERSION_CODE < KERNEL_VERSION(4,0,0)
     unit = MINOR( filp->f_dentry->d_inode->i_rdev );
+# else
+    unit = MINOR( filp->f_path.dentry->d_inode->i_rdev );
+#endif
 
     WHENDEBUG(RFM2G_DBTRACE) printk(KERN_ERR"%s%d: Entering %s\n", devname,
                                     unit, me);
@@ -1047,7 +1063,11 @@
 
 
     /* Extract the minor number so we know which RFM device to access */
+# if LINUX_VERSION_CODE < KERNEL_VERSION(4,0,0)
     unit = MINOR( filp->f_dentry->d_inode->i_rdev );
+# else
+    unit = MINOR( filp->f_path.dentry->d_inode->i_rdev );
+#endif
     cfg = &(rfm2gDeviceInfo[unit].Config );
 
     WHENDEBUG(RFM2G_DBTRACE) printk(KERN_ERR"%s%d: Entering %s\n", devname,
@@ -1306,7 +1326,7 @@
 *
 ******************************************************************************/
 
-#if LINUX_VERSION_CODE < KERNEL_VERSION(3,10,0)
+#if LINUX_VERSION_CODE < KERNEL_VERSION(2,6,37)
 int
 rfm2g_ioctl( struct inode *inode, struct file *filp, unsigned int cmd,
     unsigned long arg )
@@ -1323,7 +1343,11 @@
     RFM2G_UINT32 stat;
 
 #if LINUX_VERSION_CODE > KERNEL_VERSION(2,6,36)
+# if LINUX_VERSION_CODE < KERNEL_VERSION(4,0,0)
     	struct inode *inode = filp->f_dentry->d_inode;
+# else
+    	struct inode *inode = filp->f_path.dentry->d_inode;
+# endif
 #endif
 
 	/* Valid Call? */
@@ -2738,8 +2762,13 @@
             }
 
 			/* Temporarily map the PLX Runtime registers */
+#if LINUX_VERSION_CODE >= KERNEL_VERSION(5,0,0)
+			pRfm2g = (RFM2G_UINT8 *) ioremap( cfg->PCI.rfm2gOrBase,
+													  cfg->PCI.rfm2gOrWindowSize );
+#else
 			pRfm2g = (RFM2G_UINT8 *) ioremap_nocache( cfg->PCI.rfm2gOrBase,
 													  cfg->PCI.rfm2gOrWindowSize );
+#endif
 			if( pRfm2g == (RFM2G_UINT8 *) NULL )
 			{
 				WHENDEBUG(RFM2G_DBERROR)
