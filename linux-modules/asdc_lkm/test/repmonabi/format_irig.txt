
						   Y. Guillemot, le 8 aout 1994
							 modifie le 3 aout 2001




       FORMAT DES FICHIERS CREES PAR MONABI a partir d'une carte ABI-PMC2
       ==================================================================

			   avec l'OPTION IRIG :
			   ====================



Ces fichiers sont constitues de "blocs" possedant tous une enveloppe commune.

Ils commencent tous par une "identification".



1 - Fichier d'espionnage de base :
    ------------------------------

   BLOC_IDENTIFICATION

   [BLOC_OPTION]

   BLOC_DEBUT

   BLOC_ESPION 1

   BLOC_ESPION 2

   . . . . . . .

   BLOC_ESPION N

   BLOC_FIN



2 - Fichier d'espionnage de base, avec
    ??????? Association temps IRIG/temps machine ??????? :
    --------------------------------------------------

   BLOC_IDENTIFICATION

   [BLOC_OPTION]

   BLOC_DEBUT

   BLOC_IRIG 0

   BLOC_ESPION 1

   BLOC_IRIG 1

   BLOC_ESPION 2

   BLOC_IRIG 2

   . . . . . . .

   BLOC_ESPION N
   
   BLOC_IRIG N
   
   BLOC_FIN



    
3 - BLOC_IDENTIFICATION
    -------------------

 
    Chaque fichier possede obligatoirement un et un seul bloc d'identification.
    Ce bloc est toujours le premier du fichier.
   
   Constitution du bloc :
   
          MOT 1 (16 bits) : Identificateur du bloc ET DU FICHIER MONABI V3 : 
                                                             0x7E63 (soit "~c")
          
          MOT 2 (16 bits) : Taille du bloc (nombre de mots) - 1 : 6 ou 7
          
          MOT 3 (16 bits) : Version du logiciel monabi utilise
                            (Octet poids fort : numero majeur,
                             octet poids faible : numero mineur)
          
          MOT 4 (16 bits) : Version de la modification AEROSPATIALE du
                            microcode implante sur la carte ABI utilisee
                            (Octet poids fort : numero majeur, octet poids
                             faible : numero mineur)
                             
          MOT 5 (16 bits) : Numero du microcode SBS d'origine implante sur la 
                            carte ABI
                            
          MOT 6 (16 bits) : Version du microcode SBS d'origine implante sur la 
                            carte ABI
                            
          MOT 7 (16 bits) : Type de la carte utilisee : 0xI001 pour ABI-V
                                                        0xI003 pour ABI-V3
                                                        0xI012 pour ABIPMC2
                            Dans le mot ci-dessus : I=0 ==> Horloge "normale"
                                                    I=1 ==> Horloge IRIG
                                                          
          [MOT 8 (16 bits)] : Periode (microsecondes) de l'horloge de datation
                              Si ce mot est omis, la periode est de 32 us par
                              defaut. 
                              (Mot ignore si datation IRIG)
                            
    D'autres donnees pourront etre ajoutees ulterieurement a la fin de ce bloc.
                            
                            
4 - BLOC_OPTION
    -----------
    
    Ce bloc est destine a inclure differents renseignements dans les fichiers 
    issu de monabi.
    
    Il n'est pas utilise dans la version actuelle des logiciels.
   
   Constitution du bloc :
   
          MOT 1 (16 bits) : Identificateur du bloc : 0x0001
          
          MOT 2 (16 bits) : Taille du bloc (nombre de mots) - 1 : TAILLE
          
          MOT 3 (16 bits) :        \
                                    \
          . . . . . . .              >   Contenu du bloc : A.D.
                                    / 
          MOT TAILLE+1 (16 bits) : /
    
   
5 - BLOC_DEBUT
    ----------
    
    Ce bloc indique l'heure machine (systeme hote) au debut de l'espionnage

   Constitution du bloc :
   
          MOT 1 (16 bits) : Identificateur du bloc : 0x0002
          
          MOT 2 (16 bits) : Taille du bloc (nombre de mots) - 1 : 8
          
          MOT 3 (16 bits) : Annee
          
          MOT 4 (16 bits) : Mois
          
          MOT 5 (16 bits) : Jour du mois
          
          MOT 6 (16 bits) : Jour de la semaine
          
          MOT 7 (16 bits) : Heure
          
          MOT 8 (16 bits) : Minute
          
          MOT 9 (16 bits) : Seconde
    
   
6 - BLOC_IRIG
    ----------
    
    Ce bloc indique l'equivallence entre le temps IRIG et l'horloge de datation
    utilisee par l'ABI
    
    Il n'est pas utilise dans la version actuelle des logiciels.

   Constitution du bloc :
   
          MOT 1 (16 bits) : Identificateur du bloc : 0x0003
          
          MOT 2 (16 bits) : Taille du bloc (nombre de mots) - 1
          
          MOT 3 (16 bits) et
          MOT 4 (16 bits)     : Date interne ABI a la creation du bloc
          
          MOT 5 (16 bits) et    |
          MOT 6 (16 bits) et    |  A.D.
          MOT 7 (16 bits) et    |
          MOT 8 (16 bits)       |       : Date IRIG a la creation du bloc
          
    
   
   
7 - BLOC_ESPION
    -----------
    
    Ce bloc contient la copie brute d'un tampon d'espionnage sequentiel de
    la carte ABI V3.

   Constitution du bloc :
   
          MOT 1 (16 bits) : Identificateur du bloc : 0x0004
          
          MOT 2 (16 bits) : Taille du bloc (nombre de mots) - 2 : TAILLE
          
          MOT 3 (16 bits) : Nombre de sous-blocs echange : NSBE
                            La valeur 0xFFFF indique un debordement du tampon
                            de la carte ABI (perte de donnees)
                            
          SOUS-BLOC_ECHANGE 1
          
          SOUS-BLOC_ECHANGE 2
          
          . . . . . . .
          
          SOUS-BLOC_ECHANGE NSBE
          
          MOT TAILLE+2 (16 bits) : Numero du tampon ABI-V3 qui constitue le
                                   bloc-espion courant




7 - SOUS-BLOC_ECHANGE - Cas d'un echange sans erreur
    ------------------------------------------------

	  MOT 1 (16 bits) :
		  Bits 6-0 (0x7F) = Type de l'echange
					 1 : Commande codee
					 2 : BC -> RT
					 4 : RT -> BC
					 8 : RT -> RT
				      0x10 : Diffusion BC -> RT
				      0x18 : Diffusion RT -> RT
				      0x20 : Donnees imprevues sur le bus

		  Bit 7 (0x80) = Bus utilise (0 pour 1 [A] et 1 pour 2 [B])

		  Bits 13-8 (0x3F00) = Taille (mots) du sous-bloc echange : N

		  Bit 14 (0x4000) = Indicateur d'erreur : DOIT ETRE 0
							  -----------
		  Bit 15 (0x8000) : reserve


	  MOT 2 (16 bits) : Poids fort   |
	  MOT 3 (16 bits) : Poids moyene }  Datation IRIG au format SBS
	  MOT 4 (16 bits) : Poids faible |                                              IDENTIFICATION)

	  MOT 5 (16 bits) : Commande
	  MOT 6 (16 bits) : Donnee ou status
	  MOT 7 (16 bits) : Donnee
	   . . . . . . .
	  MOT N (16 bits) : Status ou donnee




7 - SOUS-BLOC_ECHANGE - Cas d'un echange avec erreur
    ------------------------------------------------

	  MOT 1 (16 bits) :
		  Bits 6-0 (0x7F) = Type de l'echange
					 1 : Commande codee
					 2 : BC -> RT
					 4 : RT -> BC
					 8 : RT -> RT
				      0x10 : Diffusion BC -> RT
				      0x18 : Diffusion RT -> RT
				      0x20 : Donnees imprevues sur le bus

		  Bit 7 (0x80) = Bus utilise (0 pour 1 [A] et 1 pour 2 [B])

		  Bits 13-8 (0x3F00) = Taille (mots) du sous-bloc echange : N

		  Bit 14 (0x4000) = Indicateur d'erreur : DOIT ETRE 1
							  -----------
		  Bit 15 (0x8000) : reserve


	  MOT 2 (16 bits) : Poids fort   |
	  MOT 3 (16 bits) : Poids moyene }  Datation IRIG au format SBS
	  MOT 4 (16 bits) : Poids faible |                                              IDENTIFICATION)

	  MOT 5 (16 bits) : Commande
	  MOT 6 (16 bits) : Donnee ou status
	  MOT 7 (16 bits) : Donnee
	   . . . . . . .
	  MOT N-1 (16 bits) : Status ou donnee

	  MOT N (16 bits) : Code de l'erreur (c.f. doc ABI-V3)




8 - BLOC_FIN
    ----------

    Ce bloc indique l'heure machine (systeme hote) a la fin de l'espionnage.
    A son identificateur pres, il est identique au "bloc debut".

   Constitution du bloc :

	  MOT 1 (16 bits) : Identificateur du bloc : 0x0005

	  MOT 2 (16 bits) : Taille du bloc (nombre de mots) - 1 : 8

	  MOT 3 (16 bits) : Annee

	  MOT 4 (16 bits) : Mois

	  MOT 5 (16 bits) : Jour du mois

	  MOT 6 (16 bits) : Jour de la semaine

	  MOT 7 (16 bits) : Heure

	  MOT 8 (16 bits) : Minute

	  MOT 9 (16 bits) : Seconde
